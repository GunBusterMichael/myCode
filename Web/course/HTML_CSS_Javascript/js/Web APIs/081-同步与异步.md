# 同步与异步

## 1. 单线程

### 1.1 JavaScript 是单线程语言

> JavaScript 是==单线程==语言，==同一时间只能处理一件事情==。

这就意味着，任务在被执行前需要排队。前一个任务结束，才能执行下一个任务。这会导致如下问题：

如果某任务的执行时间过长，会造成后续任务无法被执行，导致页面渲染不连贯。

## 2. 同步与异步

为了解决单线程问题，HTML5 利用多核 CPU 的计算能力，提出了 Web Worker 标准，允许 JavaScript 脚本创建多个线程。于是，JavaScript 中出现了同步与异步。

### 2.1 同步

前一个任务结束后再执行下一个任务。程序的执行顺序与任务的排序顺序是一致的、同步的。

### 2.2 异步

调整任务的执行顺序。

#### 2.2.1 举例

```javascript
console.log(1);            // 第一个被输出
setTimeout(function () {
    console.log(2);        // 第三个被输出
}, 1000);
console.log(3);			   // 第二个被输出
```

## 3. 同步任务与异步任务

> JavaScript的==事件==分为同步任务和异步任务，遇到==同步任务==就放在==执行栈==中执行，而碰到==异步任务==就放到==任务队列==之中，等到==执行栈==执行==完毕==之后==再去执行任务队列==之中的事件。

### 3.1 同步任务

#### 定义

同步任务是连续 的，阻塞的函数或代码块。

#### 执行方式

同步任务按照代码的顺序进入执行栈并执行，执行完后出栈。

### 3.2 异步任务

#### 3.2.1  定义

异步任务是不连续，非阻塞的函数或代码块，其包含异步事件及其回调。

#### 3.2.2 分类

- 普通事件：
  - click
  - resize
  - ……
  
- 资源加载：
  - load
  - error
  - ……
  
- 定时器：
  - setInterval
  
  - setTimeout
  
  - 举例：
  
    - ```javascript
      setTimeout(function() {
          console.log("Hello!");
      }, 1000);
      ```
  
      ***setTimout（setInterval）并不是立即就执行的。这段代码意思是：***
  
      ​		***等 1s 后，把这个 function 加入任务队列中，如果任务队列中没有其他任务了， 就执行输出 'Hello'。***

#### 3.2.3 任务队列（消息队列）

与异步任务相关的回调函数会被添加到任务队列中。等待执行栈中的同步任务全部执行完毕后，再执行任务队列中的回调函数。

### 3.3 JavaScript 的执行机制

#### 3.3.1 步骤

1. 同步任务按照代码的顺序进入执行栈并执行，执行完后出栈；

2. 如果遇到异步任务，异步任务进入等待状态，并通知主线程：

   ​		异步事件触发时，向任务队列入队该事件消息：事件及回调函数；

3. 执行栈后续同步代码执行完毕后，执行栈依次读取任务队列中的消息：

   ​		被读取的消息对应的异步任务结束等待状态，进入执行栈，执行回调函数。于是一次事件循环结束，即处理了一个异步任务。然后读取下一条消息。

#### 3.3.2 事件循环 Event loop

主线程从消息队列中获取消息并执行异步任务，再从消息队列中获取消息并执行异步任务，不断循环。