<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>017-02-WeakSet的语法</title>
</head>

<body>
    <script>
        /*
            1. WeakSet 构造函数
                1.1 用 WeakSet 构造函数和 new 命令创建 WeakSet 实例
        */
        {
            const ws = new WeakSet()
        }

        /*
            1.2 WeakSet 构造函数的参数
                接受一个任何具有 Iterable 接口的对象（数组或类似于数组的对象）作为参数；
                    参数中的成员会成为 WeakSet 实例的成员。
        */
        {
            // 创建一个有两个成员，且成员是数组的数组
            const arr = [[1, 2, 3], [4, 5, 6]]

            // 将数组作为 WeakSet 实例的参数，其成员成为 WeakSet 实例的成员
            const ws = new WeakSet(arr)

            console.log(ws)    // 返回 WeakSet {Array(3), Array(3)}
        }

        /*
!           参数的成员必须是对象。
        */
        {
            const arr = [1, 2]
            // const ws = new WeakSet(arr)    // 报错 Uncaught TypeError: Invalid value used in weak set
        }

        /*
            2. 实例方法
                2.1 WeakSet.prototype.add(value)
                        向 WeakSet 实例添加一个新成员；
                2.2 WeakSet.prototype.delete(value)
                        删除 WeakSet 实例中的一个指定成员；
                2.3 WeakSet.prototype.has(value)
                        返回一个布尔值，表示某个值是否在某个 WeakSet 实例中。
                2.4 WeakSet 不能遍历：
!                       没有 size 属性和 forEach 方法。
        */
        {
            const ws = new WeakSet()
            const o1 = {id: 1}
            const o2 = {id: 2}

            // 添加成员
            ws.add(o1)
            console.log(ws)    // 返回 WeakSet {{id: 1}}

            // 判断是否存在某个值
            console.log(ws.has(o1))    // 返回 true
            console.log(ws.has(o2))    // 返回 false

            // 删除成员
            ws.delete(o1)
            console.log(ws.has(o1))    // 返回 false
        }
        
        /*
            3. 用处
                储存 DOM 节点：
                    DOM 节点被删除后，不会继续保存在 WeakSet 中，不会发生内存泄漏。
        */
    </script>
</body>

</html>